# Default values for greenkube.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: greenkube/greenkube
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: 0.1.5

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ''

rbac:
  # Specifies whether RBAC resources (ClusterRole, ClusterRoleBinding) should be created
  create: true

# Non-sensitive configuration passed as environment variables from config.py
# These values will be stored in a ConfigMap.
config:
  logLevel: INFO
  cloudProvider: aws
  defaultZone: FR
  defaultIntensity: 500.0 # gCO2e/kWh, used when Electricity Maps fails
  # Normalization granularity for carbon intensity lookups.
  # Supported: "hour", "day", "none"
  normalizationGranularity: hour

  # Interval for analyzing nodes (e.g., "5m", "1h")
  nodeAnalysisInterval: 5m

  # Max age for historical node data in days
  nodeDataMaxAgeDays: 30

  # Database configuration
  db:
    # Supported: "elasticsearch", "postgres", "sqlite"
    # WARNING: "sqlite" is not recommended for production as data will be lost on pod restart.
    type: postgres
    # Path for the sqlite database file (only used if db.type is "sqlite")
    path: /data/greenkube_data.db
    # Database schema (only used if db.type is "postgres")
    schema: public

  # Persistence configuration for SQLite
  persistence:
    enabled: false
    # Storage Class Name (leave empty for default)
    storageClassName: ''
    accessMode: ReadWriteOnce
    size: 1Gi

  # Prometheus collector configuration
  prometheus:
    # If empty, GreenKube will attempt in-cluster discovery.
    url: ''
    verifyCerts: true
    # Prometheus query step (e.g., "5m", "1h"). Must be a divisor of 24 hours.
    queryRangeStep: 5m
    # Maximum number of data points to fetch in a single range query.
    queryRangeMaxSamples: 10000
    # The node label to use for discovering the instance type.
    nodeInstanceLabel: label_node_kubernetes_io_instance_type

  # OpenCost collector configuration
  opencost:
    # If empty, GreenKube will attempt in-cluster discovery.
    url: ''
    verifyCerts: true

  # Threshold in cores below which Prometheus totals are considered too small
  lowNodeCpuThreshold: 0.05

  # Default instance profile for energy estimation when an instance type is unknown
  defaults:
    # Default Power Usage Effectiveness (PUE). Overridden by cloudProvider-specific values if available.
    pue: 1.3
    instance:
      vcores: 1
      minWatts: 1.0
      maxWatts: 10.0

# Configuration for Elasticsearch (if db.type is "elasticsearch")
elasticsearch:
  hosts: http://elasticsearch-master:9200 # K8s service name for Elasticsearch
  indexName: carbon_intensity
  verifyCerts: true

# Sensitive values that will be stored in a Kubernetes Secret.
# Users MUST provide the electricityMapsToken.
secrets:
  # -- REQUIRED: Get this from https://www.electricitymaps.com/ --
  electricityMapsToken: ''

  # Connection string for PostgreSQL (only used if db.type is "postgres")
  # Example: "postgresql://user:password@host:port/dbname"
  dbConnectionString: ''

  # Prometheus authentication
  prometheus:
    username: ''
    password: ''
    bearerToken: ''

  # Elasticsearch authentication
  elasticsearch:
    user: ''
    password: ''

# Pod resource requests and limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# PostgreSQL configuration (custom statefulset)
postgres:
  enabled: true
  image:
    repository: postgres
    tag: 17-alpine
    pullPolicy: IfNotPresent
  auth:
    username: greenkube
    password: greenkube_password
    database: greenkube
  persistence:
    enabled: true
    size: 1Gi
    storageClassName: ''
